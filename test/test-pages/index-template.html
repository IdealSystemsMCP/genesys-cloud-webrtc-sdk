<html>
<head>
  <title>Test Page</title>
  <script src="https://sdk-cdn.mypurecloud.com/javascript/28.0.0/purecloud-platform-client-v2.min.js"></script>
  <script src="https://localhost:8444/index.js"></script>
  <script>
    if (window.location.href.indexOf('/cdn') > -1) {
      const script = document.createElement('script');
      // for local development
      // script.src = '../../web/purecloud-webrtc-sdk.js';
      script.src = 'https://sdk-cdn.mypurecloud.com/webrtc-sdk/latest/purecloud-webrtc-sdk.js';
      document.head.prepend(script);
    }
  </script>
  <script>
    window.environments = {
      'dca': {
        clientId: '2c75d833-922b-4324-9d0e-6c20b9c714b2', // created in valve-telphony org, dca
        uri: 'inindca.com'
      },
      'pca-us': {
        clientId: '6b9f791c-86ef-4f7a-af85-3f3520dd0975', // created in torontohackathon org
        uri: 'mypurecloud.com'
      }
    };

    // This needs to be a global since it is initialized by platformClientInit.js and utilized in app-controller.js
    window.conversationsAPI;

    window.getCurrentUrlParams = () => {
      let params = null;
      const urlParts = window.location.href.split('#');

      if (urlParts[1]) {
        const urlParamsArr = urlParts[1].split('&');

        if (urlParamsArr.length) {
          params = {};
          for (let i = 0; i < urlParamsArr.length; i++) {
            const currParam = urlParamsArr[i].split('=');
            const key = currParam[0];
            const value = currParam[1];
            params[key] = value;
          }
        }
      }

      return params;
    }
  </script>
  <link rel="stylesheet" type="text/css" href="../common/main.css">
</head>
<body>
  <div class="app-header">
    <div class="title">PureCoud WebRTC SDK Sample</div>
    <div class="subtitle">Choose and environment to authenticate with, then click 'Start App' to initialize the SDK</div>
  </div>

  <div>
    <div>
      <label for="environment">Select Environment:</label>
      <select id="environment" name="environment">
        <option value="dca">dca</option>
        <option value="pca-us">pca-us</option>
      </select>
    </div>
    <div>
      <button id="auth-button" type="button">Use Implicit Auth</button>
      <span>or</span>
      <form id="manual-form">
        <input id="manual-auth" placeholder="Use custom access token">
        <button type="submit">Use manual auth token</button>
      </form>
    </div>
    <button id="start-app-button" type="button">Start App</button>
  </div>
  <div id="auth-text" class="auth-text">Authenticated</div>
  <div id="init-text" class="init-text">Initializing SDK...</div>
  <hr />

  <div id="app-content" class="app-content">
    <div class="top">
      <div id="app-controls" class="app-controls">

        <!-- outbound call -->
        <div class="control-title">Outbound phone call</div>
        <div class="control-section">
          <label>Enter phone number:</label>
          <input id="outbound-phone-number" type="text" class="text-input">
          <div>
            <button id="outbound-call-start">Start Call</button>
            <button id="outbound-call-end">End Call</button>
          </div>
        </div>

        <!-- inbound call -->
        <div class="control-title">Inbound phone call</div>
        <div class="control-section">
          <button id="answer-inbound-call">Answer</button>
          <button id="inbound-call-end">End Call</button>
        </div>

        <!-- video -->
        <div class="control-title">Video conference</div>
        <div class="control-section">
          <label>Enter room jid:</label>
          <input id="video-jid" type="text" class="text-input">
          <div>
            <span id="start-controls">
              <button id="video-start">Start</button>
              <button id="video-start-no-video">Start - No Video</button>
              <button id="video-start-no-audio">Start - No Audio</button>
              <button id="video-start-no-audio-video">Start - No Audio/Video</button>
            </span>

            <div id="video-controls" class="hidden">
              <div>
                <button id="start-screen-share">Start screen share</button>
                <br />
                <button id="stop-screen-share">Stop screen share</button>
              </div>
              <div>
                <button id="audio-mute">Mute mic</button>
                <br />
                <button id="audio-unmute">Unmute mic</button>
              </div>
              <div>
                <button id="video-mute">Mute camera</button>
                <br />
                <button id="video-unmute">Unmute camera</button>
              </div>

              <button id="video-end">End Call</button>
            </div>
          </div>
        </div>

        <!-- Disconnect -->
        <div class="control-title">
          <div><a class="control-link" href="#" id="disconnect-sdk">Disconnect</a></div>
        </div>
      </div>

      <div class="output-container">
        <div class="log-header">
          <span>Log:</span>
          <span>
            <input name="log-traces-check" type="checkbox" id="log-traces-check"/>
            <label for="log-traces-check">Log trace events</label>
          </span>
        </div>
        <textarea id="log-data" class="log-data" readonly="true"></textarea>
        <div>
          <button type="button" id="clear-log">Clear Log</button>
        </div>
      </div>
    </div>

    <div>
      <div id="waiting-for-media" class="hidden">Waiting for incoming media</div>
      <audio id="vid-audio"></audio>
      <video id="vid-video"></video>
    </div>

  </div>

  <div class="footer">
    <a href="https://help.mypurecloud.com/articles/purecloud-privacy-policy/">Genesys Privacy Policy</a>
  </div>
  <script src="../common/platform-client.js"></script>
  <script src="sdk-sample.js"></script>
</body>
